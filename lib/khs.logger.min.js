/*! khs.logger - v0.0.6 2014-01-22 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(b){b&&(b.Loglevel&&(console.log("From remote url, setting LogLevel = "+b.LogLevel),a.Log.LogLevel=b.LogLevel),b.remoteUrl&&(console.log("From remote url, setting remoteUrl = "+b.remoteUrl),a.Log.remoteUrl=b.remoteUrl),b.prefix&&(console.log("From remote url, setting prefix = "+b.prefix),a.Log.prefix=b.prefix),b.remoteLevel&&(console.log("From remote url, remoteUrl = "+b.remoteLevel),a.Log.remoteLevel=b.remoteLevel))}function c(a,b){return(1e15+a+"").slice(-b)}function d(b,c){var d=function(d){if(i){d.stopPropagation(),f(j)&&(null!==j&&a("#khstooltip").remove(),b.attr("title",k)),k=b.attr("title"),b.attr("title","showing");var e="";for(var g in a.Log.inspectors)e+=a.Log.inspectors[g].call(null,b);var h=c+e;a("body").append('<div id="khstooltip"><div class="khstipHeader"><span class="closeButton">X</span></div><div class="khstipBody"><h>'+h+'</div><div class="khstipFooter"></div></div>'),a("#khstooltip").css("top",d.pageY).css("left",d.pageX).fadeIn("500").fadeTo("10",.8),a("#khstooltip .closeButton").css({"float":"right","font-size":"14px","background-color":"#FFFFFF",color:"#000000",padding:"4px","margin-top":"8px","font-weight":"700"}).hover(function(){a(this).css({"background-color":"#000000",color:"#ffffff",cursor:"pointer"})},function(){a(this).css({"background-color":"#FFFFFF",color:"#000000"})}).on("click",this,function(){a(this).parents("#khstooltip").remove()})}};b.mouseenter(function(){j=b,i&&(j.css("outline","medium solid #FF0000"),j.attr("title","showing"),j.dblclick(d))}).mousemove(function(){}).mouseleave(function(){null!==j&&(j.attr("title",k),j.css("outline",""),j=null),b.css("outline","")})}function e(b){var c=localStorage["local.logs"],d=null;d=null===c||void 0===c||""===c?{entries:[]}:JSON.parse(c),d.entries.push(b),d.entries.length>a.Log.logLength&&d.entries.shift(),localStorage["local.logs"]=JSON.stringify(d)}function f(a){var b=a.attr("title");return"showing"==b}function g(){var b=" #khstooltip {  position:absolute;  z-index:9999;  color:#fff;  font-size:10px;  width:580px; }",c=" #khstooltip .khstipHeader {  height:8px; } ",d="/* IE hack */*html #khstooltip .khstipHeader {margin-bottom:-6px;}",e="#khstooltip .khstipBody { background-color:#000;  padding:5px;  }",f="#khstooltip .khstipFooter { height:8px;  } ",g="<style>"+b+c+d+e+f+"</style>";a(g).appendTo("body")}function h(){window.onkeydown=function(b){if(-1!=a.Log.keyCodes.indexOf(b.keyCode)&&b.ctrlKey&&(a.Log.showOutline(),a.Log.isInspecting()?(a.Log.inspectOff(),a.Log.debug("inspecting off")):(a.Log.inspectOn(),a.Log.debug("inspecting on"))),b.keyCode==a.Log.modelDumpKeyCode&&b.ctrlKey){for(var c=a("[data-json]").map(function(){return a(this).attr("data-json")}).get(),d="",e="",f=0;f<c.length;f++){var g=c[f].split("<~>");d=g[0],model=g[1],e=e+"<b>"+d+"</b></br><textarea rows='20' cols='80'>"+model+"</textarea></br>"}var h=window.open();h.document.write("<html><head><title>JSON MODELS</title></head><body><div class='khstipBody'>"+e+"</div><div class='khstipFooter'></div></body></html>")}b.keyCode==a.Log.pullSettingsKeyCode&&b.ctrlKey&&(null!==a.Log.pullSettingsUrl?q(a.Log.pullSettingsUrl,a.Log.beforeSend):console.log("Log settings pull url not set, set $.Log.pullSettingsUrl to a URL"))},window.onkeyup=function(b){-1!=a.Log.keyCodes.indexOf(b.keyCode)&&a.Log.hideOutline()},g()}var i=!1,j=null,k=null,l=!1;window.console||(window.console={}),window.console.log||(window.console.log=function(){}),window.console.info||(window.console.info=function(){}),window.console.debug||(window.console.debug=function(){}),window.console.error||(window.console.error=function(){}),window.console.warn||(window.console.warn=function(){}),a.LogLevel={log:0,debug:1,info:2,warn:3,error:4},a.Log={keyCodes:[10,13],logKeyCode:17,level:a.LogLevel.info,modelDumpKeyCode:77,pullSettingsKeyCode:80,divs:{},inspectors:[],logLocal:!1,logLength:100,remoteLevel:a.LogLevel.error,color:"#FF0000",remoteUrl:null,pullSettingsUrl:null,beforeSend:null,log:function(b){if(this.level<=a.LogLevel.log){var c=o("LOG",b);this.remoteLevel<=a.LogLevel.log&&p(this.remoteUrl,c,this.beforeSend),this.logLocal&&e(c),console.log(c)}},info:function(b){if(this.level<=a.LogLevel.info){var c=o("INFO",b);this.remoteLevel<=a.LogLevel.info&&p(this.remoteUrl,c,this.beforeSend),this.logLocal&&e(c),console.info(c)}},debug:function(b){if(this.level<=a.LogLevel.debug){var c=o("DEBUG",b);this.remoteLevel<=a.LogLevel.debug&&p(this.remoteUrl,c,this.beforeSend),this.logLocal&&e(c),console.debug(c)}},error:function(b){if(this.level<=a.LogLevel.error){var c=o("ERROR",b);this.remoteLevel<=a.LogLevel.error&&p(this.remoteUrl,c,this.beforeSend),this.logLocal&&e(c),console.error(c)}},warn:function(b){if(this.level<=a.LogLevel.warn){var c=o("WARN",b);this.remoteLevel<=a.LogLevel.warn&&p(this.remoteUrl,c,this.beforeSend),this.logLocal&&e(c),console.warn(c)}},inspect:function(){l=!0,h()},inspectOn:function(){i=!0},inspectOff:function(){i=!1},isInspecting:function(){return i},install:function(a){this.inspectors.push(a)},mark:function(b,c,e){if(l){var f,g="<b>Model:<b>&nbsp;</br>",h="<div><b>Id:&nbsp;</b>"+b.attr("id")+"</br><b>View:&nbsp;</b>"+c+"</div>";null!==e&void 0!==e&&(f=n(e,""),g+="<div style='max-height : 512px; overflow : auto;'><pre>"+f+"</pre></div>",h+=g);var i=b.attr("id")+c;this.divs[i]=b,d(b,h),e&&b.attr("data-json",c+"<~>"+f),a.Log.info("Marked "+c+" for inspection")}},showOutline:function(){for(var a in this.divs)this.divs[a].css("outline","medium solid #FF0000")},hideOutline:function(){for(var a in this.divs)this.divs[a].css("outline","")},localStorageLogInspector:function(){return function(){var b="<b>Log Entries ("+a.Log.logLength+")</b>";b+="<div style='height : 150px; overflow : auto;'><pre>";var c=JSON.parse(localStorage["local.logs"]);for(var d in c.entries)b+=c.entries[d]+"</br>";return b+="</pre></div>"}},localLogEntries:function(){return JSON.parse(localStorage["local.logs"])},resetLocalLog:function(){localStorage["local.logs"]=""}};var m=function(a){return"object"==typeof a?null===a?"null":a.constructor===[].constructor?"array":a.constructor===(new Date).constructor?"date":a.constructor===(new RegExp).constructor?"regex":"object":typeof a},n=function(b,c){var d,e;arguments.length<2&&(c="");var f="    ",g=m(b);if("array"===g){if(0===b.length)return"[]";d="["}else{if(e=0,a.each(b,function(){e++}),0===e)return"{}";d="{"}return e=0,a.each(b,function(a,b){switch(e>0&&(d+=","),d+="array"==g?"\n"+c+f:"\n"+c+f+'"'+a+'": ',m(b)){case"array":case"object":d+=n(b,c+f);break;case"boolean":case"number":d+=b.toString();break;case"null":d+="null";break;case"string":d+='"'+b+'"';break;default:d+="TYPEOF: "+typeof b}e++}),d+="array"==g?"\n"+c+"]":"\n"+c+"}"},o=function(b,d){a.Log.prefix&&(b="function"==typeof a.Log.prefix?b+":"+a.Log.prefix():b+":"+a.Log.prefix);var e=new Date,f=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+":"+c(e.getHours(),2)+":"+c(e.getMinutes(),2)+":"+c(e.getSeconds(),2)+":"+c(e.getMilliseconds(),3);return b+":"+f+"->"+d},p=function(b,c,d){if(null!==b){var e=b;a.ajax({url:e,type:"POST",contentType:"application/json",data:JSON.stringify({log:c}),beforeSend:d,success:function(){},error:function(){console.error("Error sending remote log message to - "+e)}})}},q=function(c,d){if(null!==c){var e=c;a.ajax({url:e,type:"GET",contentType:"application/json",beforeSend:d,success:function(a){b(a),console.log("Logging settins pulled and applied from server")},error:function(){console.error("Error sending remote log message to - "+e)}})}};return a(function(){}),a.Log});